package attacks

import (
	"testing"

	"github.com/sourcekris/goRsaTool/keys"

	fmp "github.com/sourcekris/goflint"
)

// TODO(sewid): Fix FactorDB it currently panics.
func TestFactorDB(t *testing.T) {
	n, _ := new(fmp.Fmpz).SetString("20621750267152614372511154127630834828650842471403197420627624634995641445264611301521536394494222306763722460243604532087804596343272883051903137446807706391744484874946564173593120000142622355944703599984473382960498060488910223822540413244808714312244235115271360890728119312050221054304224094425401105613861305013563551491405848481731889924108755979093970620085407418359069151521144533567160634522778749571920873926079138541765308326114841382175052307472122163146240196121035096483713942342665052475556933935388266918227885989332020342701994949078216608386954333308039363006045786860788193669735242074089496043435024347118605259049621001327230673967595302433625181686605594786528098202718607801030192494015103992593214635574174522017403594005403830602202622875443113701334420808107862798497828867783496364857938305727954479262889562215186039812208961157944153847667741946574776559918179497703075672189532278215230459842346727333821666928332552333954971343144638788445876559729810114877258966889615038147223912298289028203488466463162267754958689409484898706404559934123043284971567725086474382475621264461467749881262867183918666999257623698881935700778315383291602059022026520649681886632336532971772561243278837804579164761873982701072229548260362895897175683450182134223930218685437070014488524291887235297736000334494161657111252307087006035832384130465403417980554372043101397013216895293397052167751542665730166593979774386291641308772888852080245934262055011545622216721626363751043643672791515962299025554287440123722439149120145872057816348015657632897793224454092673651710521209221224810118747827968189052429492509290693652292202416403871346427335546648614804149133552945105363241107403", 10)
	d, _ := new(fmp.Fmpz).SetString("14238595317742999419724769754938781250763374470504693325614853324964337260473761783498650279800083214113633597028905025886220696539808676487810990320055777986981852771353692958470211836465718666232109840287126433195683319883175557901548380910643440062001066316754571488874042555954415870856469543873595456461736697028682488800793537233117929581089236870927586928444768162841848698833991657971032941281875294823977165052113666215510834712241343835884906653153316853610952166675061327465777800946124641108146027349487613338446260485615586412669839642820611579619907362274358756247706196689009661388851221985884813635825504296909764451097355517611659461901982985438319875683493691292185874791454027302223634094551220182928350121430134182932680525006618513686890299973399823621425339643252481969356228777834892814497731772214904298621666938042545923216036622280857561481218613941747916051982796584394075704969343201573114019706739472353533570433321961502164740514091636637780492428422152802027694448630255895922836897000702331310179336977926093427139350738453364877976422537279772077127699346944728179537841470709234243192668642484338161733467897372256061394288813328955281782536646768400934960342368840602795111181320138753910625976217707986214333176969850908466890333594217718026081513558619037578427556655148048046773445254770046703210886334867336022023628871143385342445444410753899728096994258681023961045321666172428810183101037727271943427218732327700395005707600420809642680284162289111586274530200849792802191262356412444502379217320999333688778283650434020762899496775640122865207935335877762413652189409275709066819501802370174771676153309355768377030948939894121990057375593506757266976551113", 10)

	fmpPubKey := &keys.FMPPublicKey{
		N: n,
		E: fmp.NewFmpz(65537),
	}

	targetRSA, _ := keys.NewRSA(keys.PrivateFromPublic(fmpPubKey), nil, nil, "")
	FactorDB(targetRSA)

	if targetRSA.Key.D.Cmp(d) != 0 {
		t.Errorf("got %v wanted %v for d\n", targetRSA.Key.D, d)
	}
}
